{"version":3,"sources":["webpack:///webpack/universalModuleDefinition?5ca6","webpack:///pangu.min.js","webpack:///webpack/bootstrap 68fe453258b649e9baf0?65da","webpack:///./src/browser/pangu.js?52fc","webpack:///./src/shared/core.js?02df"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","Pangu","COMMENT_NODE_TYPE","BrowserPangu","_Pangu","_this","getPrototypeOf","topTags","ignoreTags","spaceSensitiveTags","spaceLikeTags","blockTags","node","parentNode","nodeName","search","isContentEditable","getAttribute","targetNode","childNodes","childNode","nodeType","textContent","xPathQuery","contextNode","textNodes","document","evaluate","XPathResult","ORDERED_NODE_SNAPSHOT_TYPE","currentTextNode","nextTextNode","snapshotLength","snapshotItem","canIgnoreNode","newText","spacing","data","nextSibling","testText","toString","substr","testNewText","nextNode","isFirstTextChild","currentNode","isLastTextChild","previousSibling","panguSpace","createElement","innerHTML","insertBefore","previousElementSibling","removeChild","spacingNodeByXPath","idName","className","tagName","_arr","_i","tag","spacingPageTitle","spacingPageBody","pangu","cjkQuote","quoteCJK","fixQuote","fixSingleQuote","hashANSCJKhash","cjkHash","hashCJK","cjkOperatorANS","ansOperatorCJK","cjkBracketCJK","cjkBracket","bracketCJK","fixBracket","fixSymbol","cjkANS","ansCJK","text","replace","oldText","tmpText","callback","arguments","undefined","err"],"mappings":"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","file":"pangu.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"pangu\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"pangu\"] = factory();\n\telse\n\t\troot[\"pangu\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"pangu\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"pangu\"] = factory();\n\telse\n\t\troot[\"pangu\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Pangu = __webpack_require__(1).Pangu;\n\t\n\t// https://developer.mozilla.org/en/docs/Web/API/Node/nodeType\n\tvar COMMENT_NODE_TYPE = 8;\n\t\n\tvar BrowserPangu = function (_Pangu) {\n\t  _inherits(BrowserPangu, _Pangu);\n\t\n\t  function BrowserPangu() {\n\t    _classCallCheck(this, BrowserPangu);\n\t\n\t    var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(BrowserPangu).call(this));\n\t\n\t    _this.topTags = /^(html|head|body|#document)$/i;\n\t    _this.ignoreTags = /^(script|code|pre|textarea)$/i;\n\t    _this.spaceSensitiveTags = /^(a|del|pre|s|strike|u)$/i;\n\t    _this.spaceLikeTags = /^(br|hr|i|img|pangu)$/i;\n\t    _this.blockTags = /^(div|h1|h2|h3|h4|h5|h6|p)$/i;\n\t\n\t    // TODO\n\t    // this.ignoreClasses\n\t    // this.ignoreAttributes\n\t    return _this;\n\t  }\n\t\n\t  _createClass(BrowserPangu, [{\n\t    key: 'canIgnoreNode',\n\t    value: function canIgnoreNode(node) {\n\t      var parentNode = node.parentNode;\n\t\n\t      while (parentNode && parentNode.nodeName && parentNode.nodeName.search(this.topTags) === -1) {\n\t        if (parentNode.nodeName.search(this.ignoreTags) >= 0 || parentNode.isContentEditable || parentNode.getAttribute('g_editable') === 'true') {\n\t          return true;\n\t        }\n\t\n\t        parentNode = parentNode.parentNode;\n\t      }\n\t\n\t      return false;\n\t    }\n\t  }, {\n\t    key: 'isFirstTextChild',\n\t    value: function isFirstTextChild(parentNode, targetNode) {\n\t      var childNodes = parentNode.childNodes;\n\t\n\t      // 只判斷第一個含有 text 的 node\n\t      for (var i = 0; i < childNodes.length; i++) {\n\t        var childNode = childNodes[i];\n\t        if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n\t          return childNode === targetNode;\n\t        }\n\t      }\n\t\n\t      return false;\n\t    }\n\t  }, {\n\t    key: 'isLastTextChild',\n\t    value: function isLastTextChild(parentNode, targetNode) {\n\t      var childNodes = parentNode.childNodes;\n\t\n\t      // 只判斷倒數第一個含有 text 的 node\n\t      for (var i = childNodes.length - 1; i > -1; i--) {\n\t        var childNode = childNodes[i];\n\t        if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n\t          return childNode === targetNode;\n\t        }\n\t      }\n\t\n\t      return false;\n\t    }\n\t  }, {\n\t    key: 'spacingNodeByXPath',\n\t    value: function spacingNodeByXPath(xPathQuery, contextNode) {\n\t      // 因為 xPathQuery 會是用 text() 結尾，所以這些 nodes 會是 text 而不是 DOM element\n\t      // snapshotLength 要配合 XPathResult.ORDERED_NODE_SNAPSHOT_TYPE 使用\n\t      // https://developer.mozilla.org/en-US/docs/DOM/document.evaluate\n\t      // https://developer.mozilla.org/en-US/docs/Web/API/XPathResult\n\t      var textNodes = document.evaluate(xPathQuery, contextNode, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n\t\n\t      var currentTextNode = void 0;\n\t      var nextTextNode = void 0;\n\t\n\t      // 從最下面、最裡面的節點開始，所以是倒序的\n\t      for (var i = textNodes.snapshotLength - 1; i > -1; --i) {\n\t        currentTextNode = textNodes.snapshotItem(i);\n\t\n\t        if (this.canIgnoreNode(currentTextNode)) {\n\t          nextTextNode = currentTextNode;\n\t          continue;\n\t        }\n\t\n\t        var newText = this.spacing(currentTextNode.data);\n\t        if (currentTextNode.data !== newText) {\n\t          currentTextNode.data = newText;\n\t        }\n\t\n\t        // 處理嵌套的 <tag> 中的文字\n\t        if (nextTextNode) {\n\t          // TODO\n\t          // 現在只是簡單地判斷相鄰的下一個 node 是不是 <br>\n\t          // 萬一遇上嵌套的標籤就不行了\n\t          if (currentTextNode.nextSibling && currentTextNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n\t            nextTextNode = currentTextNode;\n\t            continue;\n\t          }\n\t\n\t          // currentTextNode 的最後一個字 + nextTextNode 的第一個字\n\t          var testText = currentTextNode.data.toString().substr(-1) + nextTextNode.data.toString().substr(0, 1);\n\t          var testNewText = this.spacing(testText);\n\t          if (testNewText !== testText) {\n\t            // 往上找 nextTextNode 的 parent node\n\t            // 直到遇到 spaceSensitiveTags\n\t            // 而且 nextTextNode 必須是第一個 text child\n\t            // 才能把空格加在 nextTextNode 的前面\n\t            var nextNode = nextTextNode;\n\t            while (nextNode.parentNode && nextNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isFirstTextChild(nextNode.parentNode, nextNode)) {\n\t              nextNode = nextNode.parentNode;\n\t            }\n\t\n\t            var currentNode = currentTextNode;\n\t            while (currentNode.parentNode && currentNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isLastTextChild(currentNode.parentNode, currentNode)) {\n\t              currentNode = currentNode.parentNode;\n\t            }\n\t\n\t            if (currentNode.nextSibling) {\n\t              if (currentNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n\t                nextTextNode = currentTextNode;\n\t                continue;\n\t              }\n\t            }\n\t\n\t            if (currentNode.nodeName.search(this.blockTags) === -1) {\n\t              if (nextNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n\t                if (nextNode.nodeName.search(this.ignoreTags) === -1 && nextNode.nodeName.search(this.blockTags) === -1) {\n\t                  if (nextTextNode.previousSibling) {\n\t                    if (nextTextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n\t                      nextTextNode.data = ' ' + nextTextNode.data;\n\t                    }\n\t                  } else {\n\t                    // dirty hack\n\t                    if (!this.canIgnoreNode(nextTextNode)) {\n\t                      nextTextNode.data = ' ' + nextTextNode.data;\n\t                    }\n\t                  }\n\t                }\n\t              } else if (currentNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n\t                currentTextNode.data = currentTextNode.data + ' ';\n\t              } else {\n\t                var panguSpace = document.createElement('pangu');\n\t                panguSpace.innerHTML = ' ';\n\t\n\t                // 避免一直被加空格\n\t                if (nextNode.previousSibling) {\n\t                  if (nextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n\t                    nextNode.parentNode.insertBefore(panguSpace, nextNode);\n\t                  }\n\t                } else {\n\t                  nextNode.parentNode.insertBefore(panguSpace, nextNode);\n\t                }\n\t\n\t                // TODO\n\t                // 主要是想要避免在元素（通常都是 <li>）的開頭加空格\n\t                // 這個做法有點蠢，但是不管還是先硬上\n\t                if (!panguSpace.previousElementSibling) {\n\t                  if (panguSpace.parentNode) {\n\t                    panguSpace.parentNode.removeChild(panguSpace);\n\t                  }\n\t                }\n\t              }\n\t            }\n\t          }\n\t        }\n\t\n\t        nextTextNode = currentTextNode;\n\t      }\n\t    }\n\t  }, {\n\t    key: 'spacingNode',\n\t    value: function spacingNode(contextNode) {\n\t      var xPathQuery = './/*/text()[normalize-space(.)]';\n\t      this.spacingNodeByXPath(xPathQuery, contextNode);\n\t    }\n\t  }, {\n\t    key: 'spacingElementById',\n\t    value: function spacingElementById(idName) {\n\t      var xPathQuery = 'id(\"' + idName + '\")//text()';\n\t      this.spacingNodeByXPath(xPathQuery, document);\n\t    }\n\t  }, {\n\t    key: 'spacingElementByClassName',\n\t    value: function spacingElementByClassName(className) {\n\t      var xPathQuery = '//*[contains(concat(\" \", normalize-space(@class), \" \"), \"' + className + '\")]//text()';\n\t      this.spacingNodeByXPath(xPathQuery, document);\n\t    }\n\t  }, {\n\t    key: 'spacingElementByTagName',\n\t    value: function spacingElementByTagName(tagName) {\n\t      var xPathQuery = '//' + tagName + '//text()';\n\t      this.spacingNodeByXPath(xPathQuery, document);\n\t    }\n\t  }, {\n\t    key: 'spacingPageTitle',\n\t    value: function spacingPageTitle() {\n\t      var xPathQuery = '/html/head/title/text()';\n\t      this.spacingNodeByXPath(xPathQuery, document);\n\t    }\n\t  }, {\n\t    key: 'spacingPageBody',\n\t    value: function spacingPageBody() {\n\t      // // >> 任意位置的節點\n\t      // . >> 當前節點\n\t      // .. >> 父節點\n\t      // [] >> 條件\n\t      // text() >> 節點的文字內容，例如 hello 之於 <tag>hello</tag>\n\t      //\n\t      // [@contenteditable]\n\t      // 帶有 contenteditable 屬性的節點\n\t      //\n\t      // normalize-space(.)\n\t      // 當前節點的頭尾的空白字元都會被移除，大於兩個以上的空白字元會被置換成單一空白\n\t      // https://developer.mozilla.org/en-US/docs/XPath/Functions/normalize-space\n\t      //\n\t      // name(..)\n\t      // 父節點的名稱\n\t      // https://developer.mozilla.org/en-US/docs/XPath/Functions/name\n\t      //\n\t      // translate(string, \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\")\n\t      // 將 string 轉換成小寫，因為 XML 是 case-sensitive 的\n\t      // https://developer.mozilla.org/en-US/docs/XPath/Functions/translate\n\t      //\n\t      // 1. 處理 <title>\n\t      // 2. 處理 <body> 底下的節點\n\t      // 3. 略過 contentEditable 的節點\n\t      // 4. 略過特定節點，例如 <script> 和 <style>\n\t      //\n\t      // 注意，以下的 query 只會取出各節點的 text 內容！\n\t      var xPathQuery = '/html/body//*/text()[normalize-space(.)]';\n\t      var _arr = ['script', 'style', 'textarea'];\n\t      for (var _i = 0; _i < _arr.length; _i++) {\n\t        var tag = _arr[_i];\n\t        // 理論上這幾個 tag 裡面不會包含其他 tag\n\t        // 所以可以直接用 .. 取父節點\n\t        // ex: [translate(name(..), \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\") != \"script\"]\n\t        xPathQuery += '[translate(name(..),\"ABCDEFGHIJKLMNOPQRSTUVWXYZ\",\"abcdefghijklmnopqrstuvwxyz\")!=\"' + tag + '\"]';\n\t      }\n\t      this.spacingNodeByXPath(xPathQuery, document);\n\t    }\n\t\n\t    // TODO: 支援 callback 和 promise\n\t\n\t  }, {\n\t    key: 'spacingPage',\n\t    value: function spacingPage() {\n\t      this.spacingPageTitle();\n\t      this.spacingPageBody();\n\t    }\n\t  }]);\n\t\n\t  return BrowserPangu;\n\t}(Pangu);\n\t\n\tvar pangu = new BrowserPangu();\n\t\n\texports = module.exports = pangu;\n\texports.Pangu = BrowserPangu;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t// CJK is short for Chinese, Japanese and Korean.\n\t//\n\t// The constant cjk contains following Unicode blocks:\n\t// \t\\u2e80-\\u2eff CJK Radicals Supplement\n\t// \t\\u2f00-\\u2fdf Kangxi Radicals\n\t// \t\\u3040-\\u309f Hiragana\n\t// \t\\u30a0-\\u30ff Katakana\n\t// \t\\u3100-\\u312f Bopomofo\n\t// \t\\u3200-\\u32ff Enclosed CJK Letters and Months\n\t// \t\\u3400-\\u4dbf CJK Unified Ideographs Extension A\n\t// \t\\u4e00-\\u9fff CJK Unified Ideographs\n\t// \t\\uf900-\\ufaff CJK Compatibility Ideographs\n\t//\n\t// For more information about Unicode blocks, see\n\t// \thttp://unicode-table.com/en/\n\t//  https://github.com/vinta/pangu\n\t\n\t// ANS is short for Alphabets, Numbers and Symbols (`~!@#$%^&*()-_=+[]{}\\|;:'\",<.>/?).\n\t//\n\t// CAUTION: those ANS in following constants do not contain all symbols above.\n\t\n\t// cjkQuote >> 跟 Go 版差了一個 '\n\t// quoteCJK >> 跟 Go 版差了一個 '\n\tvar cjkQuote = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\"])/g;\n\tvar quoteCJK = /([\"])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\tvar fixQuote = /([\"']+)(\\s*)(.+?)(\\s*)([\"']+)/g;\n\tvar fixSingleQuote = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])( )(')([A-Za-z])/g;\n\t\n\tvar hashANSCJKhash = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])(#)([A-Za-z0-9\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff]+)(#)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\tvar cjkHash = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])(#([^ ]))/g;\n\tvar hashCJK = /(([^ ])#)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\t\n\tvar cjkOperatorANS = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\+\\-\\*\\/=&\\\\|<>])([A-Za-z0-9])/g;\n\tvar ansOperatorCJK = /([A-Za-z0-9])([\\+\\-\\*\\/=&\\\\|<>])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\t\n\tvar cjkBracketCJK = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c]+(.*?)[\\)\\]\\}>\\u201d]+)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\tvar cjkBracket = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c>])/g;\n\tvar bracketCJK = /([\\)\\]\\}>\\u201d<])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\tvar fixBracket = /([\\(\\[\\{<\\u201c]+)(\\s*)(.+?)(\\s*)([\\)\\]\\}>\\u201d]+)/;\n\t\n\tvar fixSymbol = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([~!;:,\\.\\?\\u2026])([A-Za-z0-9])/g;\n\t\n\tvar cjkANS = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([A-Za-z0-9`\\$%\\^&\\*\\-=\\+\\\\\\|/@\\u00a1-\\u00ff\\u2022\\u2027\\u2150-\\u218f])/g;\n\tvar ansCJK = /([A-Za-z0-9`~\\$%\\^&\\*\\-=\\+\\\\\\|/!;:,\\.\\?\\u00a1-\\u00ff\\u2022\\u2026\\u2027\\u2150-\\u218f])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\t\n\tvar Pangu = function () {\n\t  function Pangu() {\n\t    _classCallCheck(this, Pangu);\n\t  }\n\t\n\t  _createClass(Pangu, [{\n\t    key: 'spacing',\n\t    value: function spacing(text) {\n\t      var newText = text;\n\t\n\t      newText = newText.replace(cjkQuote, '$1 $2');\n\t      newText = newText.replace(quoteCJK, '$1 $2');\n\t      newText = newText.replace(fixQuote, '$1$3$5');\n\t      newText = newText.replace(fixSingleQuote, '$1$3$4');\n\t\n\t      newText = newText.replace(hashANSCJKhash, '$1 $2$3$4 $5');\n\t      newText = newText.replace(cjkHash, '$1 $2');\n\t      newText = newText.replace(hashCJK, '$1 $3');\n\t\n\t      newText = newText.replace(cjkOperatorANS, '$1 $2 $3');\n\t      newText = newText.replace(ansOperatorCJK, '$1 $2 $3');\n\t\n\t      var oldText = newText;\n\t      var tmpText = newText.replace(cjkBracketCJK, '$1 $2 $4');\n\t      newText = tmpText;\n\t      if (oldText === tmpText) {\n\t        newText = newText.replace(cjkBracket, '$1 $2');\n\t        newText = newText.replace(bracketCJK, '$1 $2');\n\t      }\n\t      newText = newText.replace(fixBracket, '$1$3$5');\n\t\n\t      newText = newText.replace(fixSymbol, '$1$2 $3');\n\t\n\t      newText = newText.replace(cjkANS, '$1 $2');\n\t      newText = newText.replace(ansCJK, '$1 $2');\n\t\n\t      return newText;\n\t    }\n\t  }, {\n\t    key: 'spacingText',\n\t    value: function spacingText(text) {\n\t      var callback = arguments.length <= 1 || arguments[1] === undefined ? function () {} : arguments[1];\n\t\n\t      try {\n\t        var newText = this.spacing(text);\n\t        callback(null, newText);\n\t      } catch (err) {\n\t        callback(err);\n\t      }\n\t    }\n\t  }]);\n\t\n\t  return Pangu;\n\t}();\n\t\n\tvar pangu = new Pangu();\n\t\n\texports = module.exports = pangu;\n\texports.Pangu = Pangu;\n\n/***/ }\n/******/ ])\n});\n;\n\n\n/** WEBPACK FOOTER **\n ** pangu.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 68fe453258b649e9baf0\n **/","const Pangu = require('../shared/core').Pangu;\n\n// https://developer.mozilla.org/en/docs/Web/API/Node/nodeType\nconst COMMENT_NODE_TYPE = 8;\n\nclass BrowserPangu extends Pangu {\n\n  constructor() {\n    super();\n\n    this.topTags = /^(html|head|body|#document)$/i;\n    this.ignoreTags = /^(script|code|pre|textarea)$/i;\n    this.spaceSensitiveTags = /^(a|del|pre|s|strike|u)$/i;\n    this.spaceLikeTags = /^(br|hr|i|img|pangu)$/i;\n    this.blockTags = /^(div|h1|h2|h3|h4|h5|h6|p)$/i;\n\n    // TODO\n    // this.ignoreClasses\n    // this.ignoreAttributes\n  }\n\n  canIgnoreNode(node) {\n    let parentNode = node.parentNode;\n\n    while (parentNode && parentNode.nodeName && parentNode.nodeName.search(this.topTags) === -1) {\n      if ((parentNode.nodeName.search(this.ignoreTags) >= 0) || (parentNode.isContentEditable) || (parentNode.getAttribute('g_editable') === 'true')) {\n        return true;\n      }\n\n      parentNode = parentNode.parentNode;\n    }\n\n    return false;\n  }\n\n  isFirstTextChild(parentNode, targetNode) {\n    const childNodes = parentNode.childNodes;\n\n    // 只判斷第一個含有 text 的 node\n    for (let i = 0; i < childNodes.length; i++) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n\n    return false;\n  }\n\n  isLastTextChild(parentNode, targetNode) {\n    const childNodes = parentNode.childNodes;\n\n    // 只判斷倒數第一個含有 text 的 node\n    for (let i = childNodes.length - 1; i > -1; i--) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n\n    return false;\n  }\n\n  spacingNodeByXPath(xPathQuery, contextNode) {\n    // 因為 xPathQuery 會是用 text() 結尾，所以這些 nodes 會是 text 而不是 DOM element\n    // snapshotLength 要配合 XPathResult.ORDERED_NODE_SNAPSHOT_TYPE 使用\n    // https://developer.mozilla.org/en-US/docs/DOM/document.evaluate\n    // https://developer.mozilla.org/en-US/docs/Web/API/XPathResult\n    const textNodes = document.evaluate(xPathQuery, contextNode, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n\n    let currentTextNode;\n    let nextTextNode;\n\n    // 從最下面、最裡面的節點開始，所以是倒序的\n    for (let i = textNodes.snapshotLength - 1; i > -1; --i) {\n      currentTextNode = textNodes.snapshotItem(i);\n\n      if (this.canIgnoreNode(currentTextNode)) {\n        nextTextNode = currentTextNode;\n        continue;\n      }\n\n      const newText = this.spacing(currentTextNode.data);\n      if (currentTextNode.data !== newText) {\n        currentTextNode.data = newText;\n      }\n\n      // 處理嵌套的 <tag> 中的文字\n      if (nextTextNode) {\n        // TODO\n        // 現在只是簡單地判斷相鄰的下一個 node 是不是 <br>\n        // 萬一遇上嵌套的標籤就不行了\n        if (currentTextNode.nextSibling && currentTextNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n          nextTextNode = currentTextNode;\n          continue;\n        }\n\n        // currentTextNode 的最後一個字 + nextTextNode 的第一個字\n        const testText = currentTextNode.data.toString().substr(-1) + nextTextNode.data.toString().substr(0, 1);\n        const testNewText = this.spacing(testText);\n        if (testNewText !== testText) {\n          // 往上找 nextTextNode 的 parent node\n          // 直到遇到 spaceSensitiveTags\n          // 而且 nextTextNode 必須是第一個 text child\n          // 才能把空格加在 nextTextNode 的前面\n          let nextNode = nextTextNode;\n          while (nextNode.parentNode && nextNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isFirstTextChild(nextNode.parentNode, nextNode)) {\n            nextNode = nextNode.parentNode;\n          }\n\n          let currentNode = currentTextNode;\n          while (currentNode.parentNode && currentNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isLastTextChild(currentNode.parentNode, currentNode)) {\n            currentNode = currentNode.parentNode;\n          }\n\n          if (currentNode.nextSibling) {\n            if (currentNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n              nextTextNode = currentTextNode;\n              continue;\n            }\n          }\n\n          if (currentNode.nodeName.search(this.blockTags) === -1) {\n            if (nextNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              if ((nextNode.nodeName.search(this.ignoreTags) === -1) && (nextNode.nodeName.search(this.blockTags) === -1)) {\n                if (nextTextNode.previousSibling) {\n                  if (nextTextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                    nextTextNode.data = ` ${nextTextNode.data}`;\n                  }\n                } else {\n                  // dirty hack\n                  if (!this.canIgnoreNode(nextTextNode)) {\n                    nextTextNode.data = ` ${nextTextNode.data}`;\n                  }\n                }\n              }\n            } else if (currentNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              currentTextNode.data = `${currentTextNode.data} `;\n            } else {\n              const panguSpace = document.createElement('pangu');\n              panguSpace.innerHTML = ' ';\n\n              // 避免一直被加空格\n              if (nextNode.previousSibling) {\n                if (nextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                  nextNode.parentNode.insertBefore(panguSpace, nextNode);\n                }\n              } else {\n                nextNode.parentNode.insertBefore(panguSpace, nextNode);\n              }\n\n              // TODO\n              // 主要是想要避免在元素（通常都是 <li>）的開頭加空格\n              // 這個做法有點蠢，但是不管還是先硬上\n              if (!panguSpace.previousElementSibling) {\n                if (panguSpace.parentNode) {\n                  panguSpace.parentNode.removeChild(panguSpace);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      nextTextNode = currentTextNode;\n    }\n  }\n\n  spacingNode(contextNode) {\n    const xPathQuery = './/*/text()[normalize-space(.)]';\n    this.spacingNodeByXPath(xPathQuery, contextNode);\n  }\n\n  spacingElementById(idName) {\n    const xPathQuery = `id(\"${idName}\")//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingElementByClassName(className) {\n    const xPathQuery = `//*[contains(concat(\" \", normalize-space(@class), \" \"), \"${className}\")]//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingElementByTagName(tagName) {\n    const xPathQuery = `//${tagName}//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingPageTitle() {\n    const xPathQuery = '/html/head/title/text()';\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingPageBody() {\n    // // >> 任意位置的節點\n    // . >> 當前節點\n    // .. >> 父節點\n    // [] >> 條件\n    // text() >> 節點的文字內容，例如 hello 之於 <tag>hello</tag>\n    //\n    // [@contenteditable]\n    // 帶有 contenteditable 屬性的節點\n    //\n    // normalize-space(.)\n    // 當前節點的頭尾的空白字元都會被移除，大於兩個以上的空白字元會被置換成單一空白\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/normalize-space\n    //\n    // name(..)\n    // 父節點的名稱\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/name\n    //\n    // translate(string, \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\")\n    // 將 string 轉換成小寫，因為 XML 是 case-sensitive 的\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/translate\n    //\n    // 1. 處理 <title>\n    // 2. 處理 <body> 底下的節點\n    // 3. 略過 contentEditable 的節點\n    // 4. 略過特定節點，例如 <script> 和 <style>\n    //\n    // 注意，以下的 query 只會取出各節點的 text 內容！\n    let xPathQuery = '/html/body//*/text()[normalize-space(.)]';\n    for (const tag of ['script', 'style', 'textarea']) {\n      // 理論上這幾個 tag 裡面不會包含其他 tag\n      // 所以可以直接用 .. 取父節點\n      // ex: [translate(name(..), \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\") != \"script\"]\n      xPathQuery += `[translate(name(..),\"ABCDEFGHIJKLMNOPQRSTUVWXYZ\",\"abcdefghijklmnopqrstuvwxyz\")!=\"${tag}\"]`;\n    }\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  // TODO: 支援 callback 和 promise\n  spacingPage() {\n    this.spacingPageTitle();\n    this.spacingPageBody();\n  }\n\n}\n\nconst pangu = new BrowserPangu();\n\nexports = module.exports = pangu;\nexports.Pangu = BrowserPangu;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/browser/pangu.js\n **/","// CJK is short for Chinese, Japanese and Korean.\n//\n// The constant cjk contains following Unicode blocks:\n// \t\\u2e80-\\u2eff CJK Radicals Supplement\n// \t\\u2f00-\\u2fdf Kangxi Radicals\n// \t\\u3040-\\u309f Hiragana\n// \t\\u30a0-\\u30ff Katakana\n// \t\\u3100-\\u312f Bopomofo\n// \t\\u3200-\\u32ff Enclosed CJK Letters and Months\n// \t\\u3400-\\u4dbf CJK Unified Ideographs Extension A\n// \t\\u4e00-\\u9fff CJK Unified Ideographs\n// \t\\uf900-\\ufaff CJK Compatibility Ideographs\n//\n// For more information about Unicode blocks, see\n// \thttp://unicode-table.com/en/\n//  https://github.com/vinta/pangu\n\n// ANS is short for Alphabets, Numbers and Symbols (`~!@#$%^&*()-_=+[]{}\\|;:'\",<.>/?).\n//\n// CAUTION: those ANS in following constants do not contain all symbols above.\n\n// cjkQuote >> 跟 Go 版差了一個 '\n// quoteCJK >> 跟 Go 版差了一個 '\nconst cjkQuote = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\"])/g;\nconst quoteCJK = /([\"])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst fixQuote = /([\"']+)(\\s*)(.+?)(\\s*)([\"']+)/g;\nconst fixSingleQuote = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])( )(')([A-Za-z])/g;\n\nconst hashANSCJKhash = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])(#)([A-Za-z0-9\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff]+)(#)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst cjkHash = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])(#([^ ]))/g;\nconst hashCJK = /(([^ ])#)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\nconst cjkOperatorANS = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\+\\-\\*\\/=&\\\\|<>])([A-Za-z0-9])/g;\nconst ansOperatorCJK = /([A-Za-z0-9])([\\+\\-\\*\\/=&\\\\|<>])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\nconst cjkBracketCJK = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c]+(.*?)[\\)\\]\\}>\\u201d]+)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst cjkBracket = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c>])/g;\nconst bracketCJK = /([\\)\\]\\}>\\u201d<])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst fixBracket = /([\\(\\[\\{<\\u201c]+)(\\s*)(.+?)(\\s*)([\\)\\]\\}>\\u201d]+)/;\n\nconst fixSymbol = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([~!;:,\\.\\?\\u2026])([A-Za-z0-9])/g;\n\nconst cjkANS = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([A-Za-z0-9`\\$%\\^&\\*\\-=\\+\\\\\\|/@\\u00a1-\\u00ff\\u2022\\u2027\\u2150-\\u218f])/g;\nconst ansCJK = /([A-Za-z0-9`~\\$%\\^&\\*\\-=\\+\\\\\\|/!;:,\\.\\?\\u00a1-\\u00ff\\u2022\\u2026\\u2027\\u2150-\\u218f])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\nclass Pangu {\n\n  spacing(text) {\n    let newText = text;\n\n    newText = newText.replace(cjkQuote, '$1 $2');\n    newText = newText.replace(quoteCJK, '$1 $2');\n    newText = newText.replace(fixQuote, '$1$3$5');\n    newText = newText.replace(fixSingleQuote, '$1$3$4');\n\n    newText = newText.replace(hashANSCJKhash, '$1 $2$3$4 $5');\n    newText = newText.replace(cjkHash, '$1 $2');\n    newText = newText.replace(hashCJK, '$1 $3');\n\n    newText = newText.replace(cjkOperatorANS, '$1 $2 $3');\n    newText = newText.replace(ansOperatorCJK, '$1 $2 $3');\n\n    const oldText = newText;\n    const tmpText = newText.replace(cjkBracketCJK, '$1 $2 $4');\n    newText = tmpText;\n    if (oldText === tmpText) {\n      newText = newText.replace(cjkBracket, '$1 $2');\n      newText = newText.replace(bracketCJK, '$1 $2');\n    }\n    newText = newText.replace(fixBracket, '$1$3$5');\n\n    newText = newText.replace(fixSymbol, '$1$2 $3');\n\n    newText = newText.replace(cjkANS, '$1 $2');\n    newText = newText.replace(ansCJK, '$1 $2');\n\n    return newText;\n  }\n\n  spacingText(text, callback = () => {}) {\n    try {\n      const newText = this.spacing(text);\n      callback(null, newText);\n    } catch (err) {\n      callback(err);\n    }\n  }\n\n}\n\nconst pangu = new Pangu();\n\nexports = module.exports = pangu;\nexports.Pangu = Pangu;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/shared/core.js\n **/"],"sourceRoot":""}