{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 68fe453258b649e9baf0","webpack:///./src/browser/pangu.js","webpack:///./src/shared/core.js"],"names":[],"mappings":"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","file":"pangu.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"pangu\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"pangu\"] = factory();\n\telse\n\t\troot[\"pangu\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 68fe453258b649e9baf0\n **/","const Pangu = require('../shared/core').Pangu;\n\n// https://developer.mozilla.org/en/docs/Web/API/Node/nodeType\nconst COMMENT_NODE_TYPE = 8;\n\nclass BrowserPangu extends Pangu {\n\n  constructor() {\n    super();\n\n    this.topTags = /^(html|head|body|#document)$/i;\n    this.ignoreTags = /^(script|code|pre|textarea)$/i;\n    this.spaceSensitiveTags = /^(a|del|pre|s|strike|u)$/i;\n    this.spaceLikeTags = /^(br|hr|i|img|pangu)$/i;\n    this.blockTags = /^(div|h1|h2|h3|h4|h5|h6|p)$/i;\n\n    // TODO\n    // this.ignoreClasses\n    // this.ignoreAttributes\n  }\n\n  canIgnoreNode(node) {\n    let parentNode = node.parentNode;\n\n    while (parentNode && parentNode.nodeName && parentNode.nodeName.search(this.topTags) === -1) {\n      if ((parentNode.nodeName.search(this.ignoreTags) >= 0) || (parentNode.isContentEditable) || (parentNode.getAttribute('g_editable') === 'true')) {\n        return true;\n      }\n\n      parentNode = parentNode.parentNode;\n    }\n\n    return false;\n  }\n\n  isFirstTextChild(parentNode, targetNode) {\n    const childNodes = parentNode.childNodes;\n\n    // 只判斷第一個含有 text 的 node\n    for (let i = 0; i < childNodes.length; i++) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n\n    return false;\n  }\n\n  isLastTextChild(parentNode, targetNode) {\n    const childNodes = parentNode.childNodes;\n\n    // 只判斷倒數第一個含有 text 的 node\n    for (let i = childNodes.length - 1; i > -1; i--) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n\n    return false;\n  }\n\n  spacingNodeByXPath(xPathQuery, contextNode) {\n    // 因為 xPathQuery 會是用 text() 結尾，所以這些 nodes 會是 text 而不是 DOM element\n    // snapshotLength 要配合 XPathResult.ORDERED_NODE_SNAPSHOT_TYPE 使用\n    // https://developer.mozilla.org/en-US/docs/DOM/document.evaluate\n    // https://developer.mozilla.org/en-US/docs/Web/API/XPathResult\n    const textNodes = document.evaluate(xPathQuery, contextNode, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n\n    let currentTextNode;\n    let nextTextNode;\n\n    // 從最下面、最裡面的節點開始，所以是倒序的\n    for (let i = textNodes.snapshotLength - 1; i > -1; --i) {\n      currentTextNode = textNodes.snapshotItem(i);\n\n      if (this.canIgnoreNode(currentTextNode)) {\n        nextTextNode = currentTextNode;\n        continue;\n      }\n\n      const newText = this.spacing(currentTextNode.data);\n      if (currentTextNode.data !== newText) {\n        currentTextNode.data = newText;\n      }\n\n      // 處理嵌套的 <tag> 中的文字\n      if (nextTextNode) {\n        // TODO\n        // 現在只是簡單地判斷相鄰的下一個 node 是不是 <br>\n        // 萬一遇上嵌套的標籤就不行了\n        if (currentTextNode.nextSibling && currentTextNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n          nextTextNode = currentTextNode;\n          continue;\n        }\n\n        // currentTextNode 的最後一個字 + nextTextNode 的第一個字\n        const testText = currentTextNode.data.toString().substr(-1) + nextTextNode.data.toString().substr(0, 1);\n        const testNewText = this.spacing(testText);\n        if (testNewText !== testText) {\n          // 往上找 nextTextNode 的 parent node\n          // 直到遇到 spaceSensitiveTags\n          // 而且 nextTextNode 必須是第一個 text child\n          // 才能把空格加在 nextTextNode 的前面\n          let nextNode = nextTextNode;\n          while (nextNode.parentNode && nextNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isFirstTextChild(nextNode.parentNode, nextNode)) {\n            nextNode = nextNode.parentNode;\n          }\n\n          let currentNode = currentTextNode;\n          while (currentNode.parentNode && currentNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isLastTextChild(currentNode.parentNode, currentNode)) {\n            currentNode = currentNode.parentNode;\n          }\n\n          if (currentNode.nextSibling) {\n            if (currentNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n              nextTextNode = currentTextNode;\n              continue;\n            }\n          }\n\n          if (currentNode.nodeName.search(this.blockTags) === -1) {\n            if (nextNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              if ((nextNode.nodeName.search(this.ignoreTags) === -1) && (nextNode.nodeName.search(this.blockTags) === -1)) {\n                if (nextTextNode.previousSibling) {\n                  if (nextTextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                    nextTextNode.data = ` ${nextTextNode.data}`;\n                  }\n                } else {\n                  // dirty hack\n                  if (!this.canIgnoreNode(nextTextNode)) {\n                    nextTextNode.data = ` ${nextTextNode.data}`;\n                  }\n                }\n              }\n            } else if (currentNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              currentTextNode.data = `${currentTextNode.data} `;\n            } else {\n              const panguSpace = document.createElement('pangu');\n              panguSpace.innerHTML = ' ';\n\n              // 避免一直被加空格\n              if (nextNode.previousSibling) {\n                if (nextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                  nextNode.parentNode.insertBefore(panguSpace, nextNode);\n                }\n              } else {\n                nextNode.parentNode.insertBefore(panguSpace, nextNode);\n              }\n\n              // TODO\n              // 主要是想要避免在元素（通常都是 <li>）的開頭加空格\n              // 這個做法有點蠢，但是不管還是先硬上\n              if (!panguSpace.previousElementSibling) {\n                if (panguSpace.parentNode) {\n                  panguSpace.parentNode.removeChild(panguSpace);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      nextTextNode = currentTextNode;\n    }\n  }\n\n  spacingNode(contextNode) {\n    const xPathQuery = './/*/text()[normalize-space(.)]';\n    this.spacingNodeByXPath(xPathQuery, contextNode);\n  }\n\n  spacingElementById(idName) {\n    const xPathQuery = `id(\"${idName}\")//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingElementByClassName(className) {\n    const xPathQuery = `//*[contains(concat(\" \", normalize-space(@class), \" \"), \"${className}\")]//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingElementByTagName(tagName) {\n    const xPathQuery = `//${tagName}//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingPageTitle() {\n    const xPathQuery = '/html/head/title/text()';\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingPageBody() {\n    // // >> 任意位置的節點\n    // . >> 當前節點\n    // .. >> 父節點\n    // [] >> 條件\n    // text() >> 節點的文字內容，例如 hello 之於 <tag>hello</tag>\n    //\n    // [@contenteditable]\n    // 帶有 contenteditable 屬性的節點\n    //\n    // normalize-space(.)\n    // 當前節點的頭尾的空白字元都會被移除，大於兩個以上的空白字元會被置換成單一空白\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/normalize-space\n    //\n    // name(..)\n    // 父節點的名稱\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/name\n    //\n    // translate(string, \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\")\n    // 將 string 轉換成小寫，因為 XML 是 case-sensitive 的\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/translate\n    //\n    // 1. 處理 <title>\n    // 2. 處理 <body> 底下的節點\n    // 3. 略過 contentEditable 的節點\n    // 4. 略過特定節點，例如 <script> 和 <style>\n    //\n    // 注意，以下的 query 只會取出各節點的 text 內容！\n    let xPathQuery = '/html/body//*/text()[normalize-space(.)]';\n    for (const tag of ['script', 'style', 'textarea']) {\n      // 理論上這幾個 tag 裡面不會包含其他 tag\n      // 所以可以直接用 .. 取父節點\n      // ex: [translate(name(..), \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\") != \"script\"]\n      xPathQuery += `[translate(name(..),\"ABCDEFGHIJKLMNOPQRSTUVWXYZ\",\"abcdefghijklmnopqrstuvwxyz\")!=\"${tag}\"]`;\n    }\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  // TODO: 支援 callback 和 promise\n  spacingPage() {\n    this.spacingPageTitle();\n    this.spacingPageBody();\n  }\n\n}\n\nconst pangu = new BrowserPangu();\n\nexports = module.exports = pangu;\nexports.Pangu = BrowserPangu;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/browser/pangu.js\n **/","// CJK is short for Chinese, Japanese and Korean.\n//\n// The constant cjk contains following Unicode blocks:\n// \t\\u2e80-\\u2eff CJK Radicals Supplement\n// \t\\u2f00-\\u2fdf Kangxi Radicals\n// \t\\u3040-\\u309f Hiragana\n// \t\\u30a0-\\u30ff Katakana\n// \t\\u3100-\\u312f Bopomofo\n// \t\\u3200-\\u32ff Enclosed CJK Letters and Months\n// \t\\u3400-\\u4dbf CJK Unified Ideographs Extension A\n// \t\\u4e00-\\u9fff CJK Unified Ideographs\n// \t\\uf900-\\ufaff CJK Compatibility Ideographs\n//\n// For more information about Unicode blocks, see\n// \thttp://unicode-table.com/en/\n//  https://github.com/vinta/pangu\n\n// ANS is short for Alphabets, Numbers and Symbols (`~!@#$%^&*()-_=+[]{}\\|;:'\",<.>/?).\n//\n// CAUTION: those ANS in following constants do not contain all symbols above.\n\n// cjkQuote >> 跟 Go 版差了一個 '\n// quoteCJK >> 跟 Go 版差了一個 '\nconst cjkQuote = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\"])/g;\nconst quoteCJK = /([\"])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst fixQuote = /([\"']+)(\\s*)(.+?)(\\s*)([\"']+)/g;\nconst fixSingleQuote = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])( )(')([A-Za-z])/g;\n\nconst hashANSCJKhash = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])(#)([A-Za-z0-9\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff]+)(#)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst cjkHash = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])(#([^ ]))/g;\nconst hashCJK = /(([^ ])#)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\nconst cjkOperatorANS = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\+\\-\\*\\/=&\\\\|<>])([A-Za-z0-9])/g;\nconst ansOperatorCJK = /([A-Za-z0-9])([\\+\\-\\*\\/=&\\\\|<>])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\nconst cjkBracketCJK = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c]+(.*?)[\\)\\]\\}>\\u201d]+)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst cjkBracket = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c>])/g;\nconst bracketCJK = /([\\)\\]\\}>\\u201d<])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst fixBracket = /([\\(\\[\\{<\\u201c]+)(\\s*)(.+?)(\\s*)([\\)\\]\\}>\\u201d]+)/;\n\nconst fixSymbol = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([~!;:,\\.\\?\\u2026])([A-Za-z0-9])/g;\n\nconst cjkANS = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([A-Za-z0-9`\\$%\\^&\\*\\-=\\+\\\\\\|/@\\u00a1-\\u00ff\\u2022\\u2027\\u2150-\\u218f])/g;\nconst ansCJK = /([A-Za-z0-9`~\\$%\\^&\\*\\-=\\+\\\\\\|/!;:,\\.\\?\\u00a1-\\u00ff\\u2022\\u2026\\u2027\\u2150-\\u218f])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\nclass Pangu {\n\n  spacing(text) {\n    let newText = text;\n\n    newText = newText.replace(cjkQuote, '$1 $2');\n    newText = newText.replace(quoteCJK, '$1 $2');\n    newText = newText.replace(fixQuote, '$1$3$5');\n    newText = newText.replace(fixSingleQuote, '$1$3$4');\n\n    newText = newText.replace(hashANSCJKhash, '$1 $2$3$4 $5');\n    newText = newText.replace(cjkHash, '$1 $2');\n    newText = newText.replace(hashCJK, '$1 $3');\n\n    newText = newText.replace(cjkOperatorANS, '$1 $2 $3');\n    newText = newText.replace(ansOperatorCJK, '$1 $2 $3');\n\n    const oldText = newText;\n    const tmpText = newText.replace(cjkBracketCJK, '$1 $2 $4');\n    newText = tmpText;\n    if (oldText === tmpText) {\n      newText = newText.replace(cjkBracket, '$1 $2');\n      newText = newText.replace(bracketCJK, '$1 $2');\n    }\n    newText = newText.replace(fixBracket, '$1$3$5');\n\n    newText = newText.replace(fixSymbol, '$1$2 $3');\n\n    newText = newText.replace(cjkANS, '$1 $2');\n    newText = newText.replace(ansCJK, '$1 $2');\n\n    return newText;\n  }\n\n  spacingText(text, callback = () => {}) {\n    try {\n      const newText = this.spacing(text);\n      callback(null, newText);\n    } catch (err) {\n      callback(err);\n    }\n  }\n\n}\n\nconst pangu = new Pangu();\n\nexports = module.exports = pangu;\nexports.Pangu = Pangu;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/shared/core.js\n **/"],"sourceRoot":""}